import{_ as c,r as t,o,c as i,a as n,b as a,e as p,d as e}from"./app.6e5a8480.js";const l={},r=p(`<h1 id="nginx\u4F5C\u4E3A\u7F13\u5B58\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#nginx\u4F5C\u4E3A\u7F13\u5B58\u670D\u52A1" aria-hidden="true">#</a> Nginx\u4F5C\u4E3A\u7F13\u5B58\u670D\u52A1</h1><h3 id="\u57FA\u672C\u914D\u7F6E\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u914D\u7F6E\u8BE6\u89E3" aria-hidden="true">#</a> \u57FA\u672C\u914D\u7F6E\u8BE6\u89E3</h3><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>    <span class="token comment">#\u9700\u8981\u9996\u5148\u914D\u7F6E \u7F13\u5B58\u76EE\u5F55\uFF0C\u6587\u4EF6\u76EE\u5F55\u5C42\u7EA72\u7EA7\uFF0C\u7A7A\u95F4\u540D\u5B57 10m\u5927\u5C0F\uFF0C\u76EE\u5F55\u6700\u5927\u5927\u5C0F(\u8D85\u8FC7\u542F\u52A8nginx\u81EA\u5DF1\u7684\u6DD8\u6C70\u89C4\u5219)\uFF0C\u572860\u5206\u949F\u7684\u65F6\u95F4\u5185\u6CA1\u6709\u88AB\u8BBF\u95EE\u5C31\u4F1A\u88AB\u6E05\u7406\uFF0C\u5B58\u653E\u4E34\u65F6\u6587\u4EF6</span>
<span class="token comment"># \u4F5C\u7528:\u8BBE\u7F6E\u7F13\u5B58\u7684\u8DEF\u5F84\u4EE5\u53CA\u5176\u4ED6\u53C2\u6570</span>
<span class="token comment"># \u53C2\u6570(\u6309\u987A\u5E8F\u4F9D\u6B21\u5BF9\u5E94):</span>
<span class="token comment">#      :path \u7F13\u5B58\u8DEF\u5F84</span>
<span class="token comment">#      :levels \u5B9A\u4E49\u76EE\u5F55\u5C42\u7EA7</span>
<span class="token comment">#      :keys_zone \u914D\u7F6E\u7F13\u5B58\u7A7A\u95F4\u540D\u79F0\u548C\u7A7A\u95F4\u5927\u5C0F</span>
<span class="token comment">#      :max_size \u914D\u7F6E\u6700\u5927\u7F13\u5B58\u5927\u5C0F\uFF0C\u8D85\u8FC7\u9650\u5236\u5C06\u542F\u7528\u6DD8\u6C70\u673A\u5236\uFF0C\u6DD8\u6C70\u6389\u4F7F\u7528\u9891\u7387\u6700\u5C11\u7684\u7F13\u5B58</span>
<span class="token comment">#      :inactive \u5728\u6307\u5B9A\u65F6\u95F4\u5185\u672A\u88AB\u8BBF\u95EE\u7684\u7F13\u5B58\u6570\u636E\u5C06\u88AB\u5220\u9664</span>
<span class="token comment">#      :use_temp_path \u4E34\u65F6\u6587\u4EF6\u5B58\u653E\u8DEF\u5F84\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u4E3Aoff</span>
<span class="token directive"><span class="token keyword">proxy_cache_path</span> /data/nginx/cache levels=1:2 keys_zone=cache_zone:10m max_size=10g inactive=10m use_temp_path=off</span><span class="token punctuation">;</span>
 
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  localhost www.a.com</span><span class="token punctuation">;</span>
 
    <span class="token comment"># \u5982\u679Curl\u4E2D\u5305\u542B\u4EE5\u4E0B\u8DEF\u5F84\u53C2\u6570\uFF0C\u90A3\u4E48 cookie_nocache \u7684\u503C\u4E3A1</span>
    <span class="token directive"><span class="token keyword">if($request_uri</span> ~^/(url3|login|register|password\\/reset))</span><span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$cookie_nocache</span> <span class="token number">1</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">slice</span> <span class="token number">5m</span></span><span class="token punctuation">;</span> <span class="token comment"># \u8BBE\u7F6E\u5207\u7247\u5927\u5C0F\uFF0C\u5C06\u4E00\u4E2A\u8BF7\u6C42\u5206\u89E3\u6210\u591A\u4E2A\u5B50\u8BF7\u6C42\uFF0C\u6BCF\u4E2A\u5B50\u8BF7\u6C42\u8FD4\u56DE\u54CD\u5E94\u5185\u5BB9\u7684\u4E00\u7247\u6BB5</span>
        <span class="token directive"><span class="token keyword">proxy_cache</span> cache_zone</span><span class="token punctuation">;</span>  <span class="token comment"># \u5F00\u542F\u7F13\u5B58</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">304</span> <span class="token number">12h</span></span><span class="token punctuation">;</span> <span class="token comment"># \u4E3A\u72B6\u6001\u7801\u4E3A200\u548C304\u7684\u54CD\u5E94\u8BBE\u7F6E12\u5C0F\u65F6\u8FC7\u671F\u7684\u7F13\u5B58</span>
        <span class="token directive"><span class="token keyword">proxy_cache_valid</span> any <span class="token number">10m</span></span><span class="token punctuation">;</span>  <span class="token comment"># \u4E3A\u5176\u5B83\u72B6\u6001\u7801\u7684\u54CD\u5E94\u8BBE\u7F6E10\u5206\u949F\u8FC7\u671F\u7684\u7F13\u5B58</span>
        <span class="token directive"><span class="token keyword">proxy_cache_key</span> <span class="token variable">$host</span><span class="token variable">$uri</span><span class="token variable">$is_args</span><span class="token variable">$args</span><span class="token variable">$slice_range</span></span><span class="token punctuation">;</span> <span class="token comment"># \u5B9A\u4E49\u7F13\u5B58\u7684key</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span>  Range <span class="token variable">$slice_range</span></span><span class="token punctuation">;</span> <span class="token comment">#\u5728\u8BF7\u6C42\u5934\u4E2D\u6DFB\u52A0Range\u53C2\u6570\uFF0C\u53EF\u5411\u670D\u52A1\u5668\u8BF7\u6C42\u6587\u4EF6\u7684\u4E00\u90E8\u5206</span>
        <span class="token directive"><span class="token keyword">add_header</span>  Nginx-Cache <span class="token string">&quot;<span class="token variable">$upstream_cache_status</span>&quot;</span></span><span class="token punctuation">;</span> <span class="token comment"># \u53EF\u6839\u636E\u8BE5\u5934\u4FE1\u606F\u5224\u65AD\u662F\u5426\u547D\u4E2D\u7F13\u5B58</span>
 
        <span class="token comment">#\u90E8\u5206\u4E0D\u8BBE\u7F6E\u7F13\u5B58 cookie_nocache\u4E0A\u9762\u914D\u7F6E\u7684\u53C2\u6570,    cookie_nocache\u4E0D\u4E3A0\u6216\u8005\u7A7A  \u90A3\u4E48\u662F\u4E0D\u4F1A\u8FDB\u884C\u7F13\u5B58\u7684</span>
        <span class="token directive"><span class="token keyword">proxy_no_cache</span> <span class="token variable">$cookie_nocache</span> <span class="token variable">$arg_nocache</span> <span class="token variable">$arg_comment</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_no_cache</span> <span class="token variable">$http_pragma</span> <span class="token variable">$http_authorization</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="\u53C2\u8003\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u94FE\u63A5" aria-hidden="true">#</a> \u53C2\u8003\u94FE\u63A5</h3>`,5),d={href:"http://nginx.org/en/docs/http/ngx_http_proxy_module.html",target:"_blank",rel:"noopener noreferrer"},k=e("Module ngx_http_proxy_module"),u={href:"http://nginx.org/en/docs/http/ngx_http_slice_module.html",target:"_blank",rel:"noopener noreferrer"},v=e("Module ngx_http_slice_module");function m(_,h){const s=t("ExternalLinkIcon");return o(),i("div",null,[r,n("ul",null,[n("li",null,[n("a",d,[k,a(s)])]),n("li",null,[n("a",u,[v,a(s)])])])])}var x=c(l,[["render",m],["__file","Nginx\u4F5C\u4E3A\u7F13\u5B58\u670D\u52A1.html.vue"]]);export{x as default};
